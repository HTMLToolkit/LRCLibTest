(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))b(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&b(h)}).observe(document,{childList:!0,subtree:!0});function p(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerPolicy&&(d.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?d.credentials="include":o.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function b(o){if(o.ep)return;o.ep=!0;const d=p(o);fetch(o.href,d)}})();(function(){const x="https://lrcgetter-backend.neeljaiswal23.workers.dev/api",a=e=>document.querySelector(e),p=e=>document.querySelectorAll(e),b=document.documentElement,o=a("#logo-img");let d=null,h=!1;const N="lrc-theme-mode",$=p(".theme-btn"),L=window.matchMedia("(prefers-color-scheme: dark)");let S=O()||"auto";j(),p(".nav-link[data-view]").forEach(e=>{e.addEventListener("click",s=>{s.preventDefault();const t=e.dataset.view;p(".nav-link").forEach(n=>n.classList.remove("active")),e.classList.add("active"),p(".view").forEach(n=>n.classList.remove("active")),a(`#view-${t}`).classList.add("active")})}),p(".tab").forEach(e=>{e.addEventListener("click",()=>{const s=e.dataset.tab;p(".tab").forEach(t=>t.classList.remove("active")),e.classList.add("active"),p(".tab-content").forEach(t=>t.classList.remove("active")),a(`#tab-${s}`).classList.add("active")})});async function v(e,s={}){const t=x+e,n={Accept:"application/json",...s.headers};let c;try{c=await fetch(t,{...s,headers:n})}catch(i){throw console.error("Network error:",i),{status:0,data:{message:"Network error - check your connection or the API may be down"}}}const l=await c.text();let r;try{r=JSON.parse(l)}catch{r={message:l||"Unknown error"}}if(!c.ok)throw{status:c.status,data:r};return r}function D(e){return Object.entries(e).filter(([s,t])=>t!=null&&t!=="").map(([s,t])=>`${encodeURIComponent(s)}=${encodeURIComponent(t)}`).join("&")}function O(){try{return localStorage.getItem(N)}catch(e){return console.warn("Unable to access stored theme preference",e),null}}function I(e){try{localStorage.setItem(N,e)}catch(s){console.warn("Unable to persist theme preference",s)}}function q(e){return e==="auto"?L.matches?"dark":"light":e}function M(e){if(!o)return;const s=o.dataset.logoLight||o.src,t=o.dataset.logoDark||o.src;e==="dark"?o.src=s:o.src=t}function P(e){S=e,I(e);const s=q(e);b.setAttribute("data-theme",s),M(s),$.forEach(t=>{t.classList.toggle("active",t.dataset.themeMode===e)})}function j(){$.length&&$.forEach(s=>{s.addEventListener("click",()=>{const t=s.dataset.themeMode||"auto";P(t)})});const e=()=>{if(S==="auto"){const s=q("auto");b.setAttribute("data-theme",s),M(s)}};typeof L.addEventListener=="function"?L.addEventListener("change",e):typeof L.addListener=="function"&&L.addListener(e),P(S)}function w(e){e.innerHTML=`
      <div class="loading">
        <div class="spinner"></div>
        <span>Loading...</span>
      </div>
    `}function y(e,s){e.innerHTML=`<div class="message error">${m(s)}</div>`}function F(e,s){e.innerHTML=`<div class="message success">${m(s)}</div>`}function m(e){if(e==null)return"";const s=document.createElement("div");return s.textContent=String(e),s.innerHTML}function A(e){const s=Math.floor(e/60),t=e%60;return`${s}:${t.toString().padStart(2,"0")}`}function g(e){return e.data?.message?e.data.message:e.data?.error?e.data.error:typeof e.data=="string"&&e.data?e.data:e.message?e.message:e.status?`HTTP Error ${e.status}`:"An unknown error occurred"}async function R(e){const s=typeof e=="string"?e:String(e??"");if(navigator.clipboard&&window.isSecureContext){await navigator.clipboard.writeText(s);return}const t=document.createElement("textarea");t.value=s,t.style.position="fixed",t.style.opacity="0",t.style.pointerEvents="none",document.body.appendChild(t),t.focus({preventScroll:!0}),t.select();const n=document.execCommand("copy");if(document.body.removeChild(t),!n)throw new Error("Copy command failed")}function E(e,s){if(!e){y(s,"No lyrics found");return}const t=e.syncedLyrics&&e.syncedLyrics.trim(),n=e.plainLyrics&&e.plainLyrics.trim();let c="";t&&(c=e.syncedLyrics.split(`
`).filter(u=>u.trim()).map(u=>{const f=u.match(/^\[(\d{2}:\d{2}\.\d{2})\]\s*(.*)$/);return f?`<div class="synced-line"><span class="timestamp">[${f[1]}]</span><span>${m(f[2])}</span></div>`:`<div>${m(u)}</div>`}).join(""));const l=n?`<pre>${m(e.plainLyrics)}</pre>`:'<p class="muted">No plain lyrics available</p>';s.innerHTML=`
      <div class="lyrics-display">
        <div class="lyrics-header">
          <div class="track-summary">
            <h2>${m(e.trackName)}</h2>
            <p>${m(e.artistName)} — ${m(e.albumName)}</p>
            <div class="result-meta" style="margin-top: 12px;">
              <span class="result-badge">${A(e.duration)}</span>
              ${t?'<span class="result-badge synced">Synced</span>':""}
              ${e.instrumental?'<span class="result-badge instrumental">Instrumental</span>':""}
              <span class="result-badge">ID: ${e.id}</span>
            </div>
          </div>
          <div class="lyrics-actions">
            <button type="button" class="btn-copy" aria-label="Copy currently visible lyrics">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              <span>Copy lyrics</span>
            </button>
          </div>
        </div>
        <div class="lyrics-tabs">
          <button class="lyrics-tab ${t?"active":""}" data-lyrics="synced" ${t?"":"disabled"}>Synchronized</button>
          <button class="lyrics-tab ${t?"":"active"}" data-lyrics="plain">Plain</button>
        </div>
        <div class="lyrics-content">
          <div id="lyrics-synced" ${t?"":'style="display: none"'}>${c||'<p class="muted">No synchronized lyrics available</p>'}</div>
          <div id="lyrics-plain" ${t?'style="display: none"':""}>${l}</div>
        </div>
      </div>
    `,s.querySelectorAll(".lyrics-tab").forEach(i=>{i.addEventListener("click",()=>{if(i.disabled)return;s.querySelectorAll(".lyrics-tab").forEach(f=>f.classList.remove("active")),i.classList.add("active");const u=i.dataset.lyrics;s.querySelector("#lyrics-synced").style.display=u==="synced"?"block":"none",s.querySelector("#lyrics-plain").style.display=u==="plain"?"block":"none"})});const r=s.querySelector(".btn-copy");if(r){const i=r.querySelector("span"),u=i&&i.textContent.trim()||"Copy lyrics",f=k=>{i?i.textContent=k:r.textContent=k};let C;const H=()=>{r.classList.remove("success"),f(u)};r.addEventListener("click",async()=>{clearTimeout(C);const T=s.querySelector(".lyrics-tab.active")?.dataset.lyrics==="synced"&&t?e.syncedLyrics:e.plainLyrics;if(!T||!T.trim()){f("Nothing to copy"),C=setTimeout(H,2e3);return}try{await R(T),r.classList.add("success"),f("Copied!")}catch(z){console.error("Copy failed:",z),r.classList.remove("success"),f("Copy failed")}finally{C=setTimeout(H,2e3)}})}}function U(e,s){if(!e||e.length===0){s.innerHTML='<div class="message info">No results found. Try different search terms.</div>';return}s.innerHTML=e.map(t=>{const n=t.syncedLyrics&&t.syncedLyrics.trim();return`
        <div class="result-card" data-id="${t.id}">
          <div class="result-header">
            <div>
              <div class="result-title">${m(t.trackName)}</div>
              <div class="result-artist">${m(t.artistName)}</div>
            </div>
            <div class="result-meta">
              <span class="result-badge">${A(t.duration)}</span>
              ${n?'<span class="result-badge synced">Synced</span>':""}
              ${t.instrumental?'<span class="result-badge instrumental">Instrumental</span>':""}
            </div>
          </div>
          <div class="result-album">${m(t.albumName)}</div>
        </div>
      `}).join(""),s.querySelectorAll(".result-card").forEach(t=>{t.addEventListener("click",async()=>{const n=t.dataset.id;w(s);try{const c=await v(`/get/${n}`);E(c,s)}catch(c){y(s,g(c))}})})}a("#form-search").addEventListener("submit",async e=>{e.preventDefault();const s=e.target,t=new FormData(s),n=Object.fromEntries(t.entries());if(!n.q&&!n.track_name){y(a("#search-results"),"Please provide at least a search query or track name");return}const c=a("#search-results");w(c);try{const l=D(n),r=await v(`/search?${l}`);U(r,c)}catch(l){console.error("Search error:",l),y(c,g(l))}}),a("#form-get-signature").addEventListener("submit",async e=>{e.preventDefault();const s=e.target,t=new FormData(s),n=Object.fromEntries(t.entries()),c=n.cached;delete n.cached;const l=a("#get-results");w(l);try{const r=c?"/get-cached":"/get",i=D(n),u=await v(`${r}?${i}`);E(u,l)}catch(r){r.status===404?y(l,"Track not found. Make sure all fields match exactly, including duration (±2 seconds)."):y(l,g(r))}}),a("#form-get-id").addEventListener("submit",async e=>{e.preventDefault();const s=new FormData(e.target).get("id").trim(),t=a("#get-results");w(t);try{const n=await v(`/get/${encodeURIComponent(s)}`);E(n,t)}catch(n){n.status===404?y(t,"Lyrics not found with this ID."):y(t,g(n))}}),a("#btn-challenge").addEventListener("click",async()=>{const e=a("#challenge-status");e.className="challenge-status working",e.textContent="Requesting challenge...";try{const s=await v("/request-challenge",{method:"POST"});d=s,a("#pub-prefix").value=s.prefix,a("#pub-nonce").value="",a("#btn-solve").disabled=!1,e.className="challenge-status success",e.textContent=`Challenge received! Prefix: ${s.prefix.substring(0,16)}...Target: ${s.target.substring(0,16)}...`}catch(s){e.className="challenge-status error",e.textContent="Failed to get challenge:  "+g(s)}});async function _(e){const s=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}async function B(e,s,t){let n=0;const c=2048,l=Date.now();for(;!h;){for(let r=0;r<c&&!h;r++){const i=`${e}: ${n}`,u=await _(i);if(u<s.toLowerCase())return{nonce:String(n),hash:u,attempts:n+1,time:Date.now()-l};n++}t&&t(n,Date.now()-l),await new Promise(r=>setTimeout(r,0))}throw new Error("Cancelled")}a("#btn-solve").addEventListener("click",async()=>{if(!d){a("#challenge-status").textContent="Please request a challenge first";return}h=!1,a("#btn-solve").disabled=!0,a("#btn-cancel").disabled=!1;const e=a("#challenge-status");e.className="challenge-status working";try{const s=await B(d.prefix,d.target,(t,n)=>{const c=Math.round(t/(n/1e3));e.textContent=`Solving...${t.toLocaleString()} attempts (${c.toLocaleString()} H/s)`});a("#pub-nonce").value=s.nonce,e.className="challenge-status success",e.textContent=`Solved! Nonce: ${s.nonce} (${s.attempts.toLocaleString()} attempts in ${(s.time/1e3).toFixed(1)}s)`}catch(s){e.className="challenge-status error",e.textContent=s.message==="Cancelled"?"Solver cancelled":`Solver error: ${s.message}`}finally{a("#btn-solve").disabled=!1,a("#btn-cancel").disabled=!0}}),a("#btn-cancel").addEventListener("click",()=>{h=!0}),a("#form-publish").addEventListener("submit",async e=>{e.preventDefault();const s=new FormData(e.target),t=Object.fromEntries(s.entries()),n=t.prefix,c=t.nonce;if(!n||!c){y(a("#publish-results"),"Please request and solve a challenge first");return}const l=`${n}:${c}`,r={trackName:t.trackName,artistName:t.artistName,albumName:t.albumName,duration:parseInt(t.duration,10),plainLyrics:t.plainLyrics||"",syncedLyrics:t.syncedLyrics||""},i=a("#publish-results");w(i);try{await v("/publish",{method:"POST",headers:{"Content-Type":"application/json","X-Publish-Token":l},body:JSON.stringify(r)}),F(i,"Lyrics published successfully!"),d=null,a("#pub-prefix").value="",a("#pub-nonce").value="",a("#btn-solve").disabled=!0,a("#challenge-status").textContent=""}catch(u){y(i,g(u))}}),console.log("LRCGetter Frontend loaded")})();
//# sourceMappingURL=index-DD7Yz1LG.js.map
